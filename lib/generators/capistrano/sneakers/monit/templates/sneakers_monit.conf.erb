# Monit configuration for Sneakers : <%= fetch(:application) %>
check process <%= sneakers_monit_service_name %>
  with pidfile "<%= fetch(:sneakers_pid) %>"
  start program = "/usr/bin/sudo -iu <%= sneakers_user(@role) %> /bin/bash -c 'cd <%= current_path %> && RAILS_ENV=<%= fetch(:sneakers_env) %> <%= SSHKit.config.command_map[:rake] %> sneakers:run'"
  stop program = "/usr/bin/sudo -iu <%= sneakers_user(@role) %> /bin/bash -c 'kill -SIGTERM `cat <%= fetch(:sneakers_pid) %>`'"
  <%= fetch(:sneakers_monit_extra) %>
